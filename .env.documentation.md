# Environment Variables Configuration

This document describes all environment variables used in the FabricSpeaks application.
**IMPORTANT:** Never commit actual `.env` files to version control!

## Required Environment Variables

### Database Configuration

```bash
# Main Database 
DATABASE_URL="postgresql://user:password@host:5432/database?sslmode=require"
DB_HOST="localhost"
DB_PORT="5432"
DB_NAME="fabricspeaks"
DB_USER="your_db_user"
DB_PASSWORD="your_secure_password"

# Connection Pool Settings (Production)
DB_POOL_MIN=5              # Minimum connections
DB_POOL_MAX=20             # Maximum connections
DB_IDLE_TIMEOUT=30000      # 30 seconds
DB_CONNECTION_TIMEOUT=2000 # 2 seconds
```

### Authentication & Security

```bash
# Supabase (Authentication)
VITE_SUPABASE_URL="https://your-project.supabase.co"
VITE_SUPABASE_ANON_KEY="your-anon-key"
SUPABASE_SERVICE_ROLE_KEY="your-service-role-key"

# Session & Cookies
SESSION_SECRET="your-very-long-random-secret-min-32-chars"
COOKIE_SECRET="another-very-long-random-secret"

# CSRF Protection
CSRF_SECRET="csrf-token-secret-min-32-chars"

# Token Encryption (for localStorage)
VITE_STORAGE_KEY="storage-encryption-key-min-32-chars"
```

### File Upload Configuration

```bash
# Upload Limits
VITE_MAX_IMAGE_SIZE=5242880        # 5MB in bytes
VITE_MAX_IMAGES_PER_PRODUCT=10     # Maximum images per product
VITE_ALLOWED_IMAGE_TYPES="image/jpeg,image/jpg,image/png,image/webp"

# Storage (Choose one)

# Option 1: Cloudinary
CLOUDINARY_CLOUD_NAME="your-cloud-name"
CLOUDINARY_API_KEY="your-api-key"
CLOUDINARY_API_SECRET="your-api-secret"
CLOUDINARY_FOLDER="fabricspeaks"

# Option 2: Local Storage
UPLOAD_DIR="./uploads"
UPLOAD_MAX_FILE_SIZE=5242880       # 5MB
```

### Payment Integration

```bash
# Razorpay
RAZORPAY_KEY_ID="rzp_test_xxx"         # Test key
RAZORPAY_KEY_SECRET="xxx"
VITE_RAZORPAY_KEY_ID="rzp_test_xxx"    # Exposed to client
```

### Email Configuration

```bash
# Nodemailer (Gmail example)
SMTP_HOST="smtp.gmail.com"
SMTP_PORT=587
SMTP_USER="your-email@gmail.com"
SMTP_PASSWORD="your-app-password"
SMTP_FROM="FabricSpeaks <noreply@fabricspeaks.com>"
```

### API & Services

```bash
# API Configuration
VITE_API_URL="http://localhost:5000"   # Development
# VITE_API_URL="https://api.fabricspeaks.com"  # Production

# Rate Limiting
API_RATE_LIMIT_WINDOW=900000       # 15 minutes in ms
API_RATE_LIMIT_MAX=100             # Max requests per window
UPLOAD_RATE_LIMIT_MAX=50           # Max uploads per hour
```

### Monitoring & Logging

```bash
# Sentry (Error Tracking)
VITE_SENTRY_DSN="https://xxx@sentry.io/xxx"
SENTRY_DSN="https://xxx@sentry.io/xxx"
SENTRY_ENVIRONMENT="development"   # or "production"
SENTRY_TRACE_SAMPLE_RATE=1.0       # 100% in dev, 0.1 in prod

# Logging Level
LOG_LEVEL="debug"                  # debug, info, warn, error
NODE_ENV="development"             # development, production, test
```

### Redis (Optional - for caching)

```bash
REDIS_URL="redis://localhost:6379"
REDIS_PASSWORD=""
REDIS_DB=0
CACHE_TTL=300                      # 5 minutes default cache
```

### Application Configuration

```bash
# Server
PORT=5000
HOST="localhost"

# Client
VITE_APP_NAME="FabricSpeaks"
VITE_APP_URL="http://localhost:5173"   # Development
# VITE_APP_URL="https://fabricspeaks.com"  # Production

# Features Flags
VITE_ENABLE_ANALYTICS=true
VITE_ENABLE_NOTIFICATIONS=true
VITE_ENABLE_REAL_TIME=false
```

---

## Environment-Specific Configurations

### Development (.env.development)

```bash
NODE_ENV=development
VITE_API_URL=http://localhost:5000
LOG_LEVEL=debug
SENTRY_TRACE_SAMPLE_RATE=1.0
DB_POOL_MIN=2
DB_POOL_MAX=5
```

### Testing (.env.test)

```bash
NODE_ENV=test
DATABASE_URL="postgresql://test:test@localhost:5432/fabricspeaks_test"
VITE_API_URL=http://localhost:5001
LOG_LEVEL=error
SENTRY_TRACE_SAMPLE_RATE=0
TEST_SKIP_AUTH=false
TEST_TIMEOUT=30000
```

### Production (.env.production)

```bash
NODE_ENV=production
VITE_API_URL=https://api.fabricspeaks.com
LOG_LEVEL=warn
SENTRY_TRACE_SAMPLE_RATE=0.1
DB_POOL_MIN=10
DB_POOL_MAX=30
SESSION_COOKIE_SECURE=true
CSRF_COOKIE_SECURE=true
RATE_LIMIT_STRICT=true
```

---

## Security Best Practices

### ✅ DO:
- Use strong, random secrets (minimum 32 characters)
- Rotate secrets regularly
- Use different secrets for different environments
- Enable secure cookies in production
- Use environment-specific `.env` files
- Validate all environment variables on startup
- Document all variables

### ❌ DON'T:
- Commit `.env` files to version control
- Share secrets in plain text
- Use the same secrets across environments
- Expose secrets in client-side code
- Use default or example secrets in production
- Store secrets in code

---

## Validation Script

Add this to your startup to validate environment variables:

```typescript
// scripts/validate-env.ts
import { z } from 'zod';

const envSchema = z.object({
  // Database
  DATABASE_URL: z.string().url(),
  DB_POOL_MAX: z.string().transform(Number).pipe(z.number().min(1).max(100)),
  
  // Auth  SESSION_SECRET: z.string().min(32),
  
  // File Upload
  VITE_MAX_IMAGE_SIZE: z.string().transform(Number).pipe(z.number().positive()),
  
  // Add all required vars...
});

try {
  envSchema.parse(process.env);
  console.log('✅ Environment variables validated');
} catch (error) {
  console.error('❌ Invalid environment variables:', error);
  process.exit(1);
}
```

---

## Quick Setup

1. Copy `.env.example` to `.env`:
   ```bash
   cp .env.example .env
   ```

2. Fill in your actual values

3. Never commit `.env` file

4. For production, use secret management service (AWS Secrets Manager, etc.)

---

## Troubleshooting

### File uploads failing
- Check `VITE_MAX_IMAGE_SIZE` is set correctly
- Verify `CLOUDINARY_*` or `UPLOAD_DIR` is configured
- Ensure upload directory has write permissions

### Database connection errors
- Verify `DATABASE_URL` format
- Check `DB_POOL_*` settings aren't too high
- Ensure database is accessible from your app

### Authentication issues
- Verify `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY`
- Check `SESSION_SECRET` is set and consistent
- Ensure cookies are enabled in browser

---

**Last Updated:** November 28, 2025  
**Maintainer:** Engineering Team
